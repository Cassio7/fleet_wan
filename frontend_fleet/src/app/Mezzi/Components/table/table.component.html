<p class="nVeicoli">Numero di veicoli: {{vehicleTableData.data.length}}</p>

<div class="table-container">
  <table mat-table [dataSource]="vehicleTableData" #vehicleTable class="mat-elevation-z8">

    <!-- Colonna Azienda -->
    <ng-container matColumnDef="Azienda">
      <th mat-header-cell *matHeaderCellDef>
        <button mat-button [matMenuTriggerFor]="aziendaMenu" class="filter-menu-btn">Azienda</button>
        <mat-menu #aziendaMenu="matMenu">
          <button mat-menu-item>Item 1</button>
          <button mat-menu-item>Item 2</button>
        </mat-menu>
      </th>
      <td mat-cell *matCellDef="let vehicle"> {{ "Azienda" }} </td>
    </ng-container>

    <!-- Colonna Targa -->
    <ng-container matColumnDef="Targa">
      <th mat-header-cell *matHeaderCellDef>
        <button mat-button [matMenuTriggerFor]="targaMenu" class="filter-menu-btn">Targa</button>
        <mat-menu #targaMenu="matMenu">
          <!-- Checkbox "Seleziona tutto" -->
          <button mat-menu-item (click)="selectDeselectAllColumnOptions('plate', $event)">
            <mat-checkbox [checked]="selectService.allPlatesSelected">Seleziona tutto</mat-checkbox>
          </button>
          <mat-divider></mat-divider>
          <!-- Checkbox per ogni veicolo -->
          <button mat-menu-item *ngFor="let vehicle of mezziFilterService.filteredVehicles" (click)="selectTarga(vehicle, $event)">
            <mat-checkbox [checked]="selectService.isPlateSelected(vehicle.plate)" (click)="selectTarga(vehicle, $event)">
              {{ vehicle.plate }}
            </mat-checkbox>
          </button>
        </mat-menu>
      </th>
      <td mat-cell *matCellDef="let vehicle">
        <mat-icon class="vehicle-icon">local_shipping</mat-icon>
        {{ vehicle.plate }}
      </td>
    </ng-container>

    <!-- Colonna Marca e Modello -->
    <ng-container matColumnDef="Marca&modello">
      <th mat-header-cell *matHeaderCellDef>
        <button mat-button [matMenuTriggerFor]="marcaMenu" class="filter-menu-btn">Marca e modello</button>
        <mat-menu #marcaMenu="matMenu">
          <!-- Checkbox "Seleziona tutto" per tutti i modelli -->
          <button mat-menu-item (click)="selectDeselectAllColumnOptions('model', $event)">
            <mat-checkbox [checked]="selectService.allModelsSelected">Seleziona tutto</mat-checkbox>
          </button>
          <mat-divider></mat-divider>

          <!-- Checkbox for each vehicle model -->
          <button mat-menu-item *ngFor="let vehicle of filterVehiclesModelsDuplicates()" (click)="selectModel(vehicle, $event)">
            <mat-checkbox [checked]="selectService.isModelSelected(vehicle.model)" (click)="selectModel(vehicle, $event)">
              {{ vehicle.model }}
            </mat-checkbox>
          </button>
        </mat-menu>
      </th>
      <td mat-cell *matCellDef="let vehicle">{{ vehicle.model }}</td>
    </ng-container>


    <!-- Colonna Cantiere -->
    <ng-container matColumnDef="Cantiere">
      <th mat-header-cell *matHeaderCellDef>
        <button mat-button [matMenuTriggerFor]="cantiereMenu" class="filter-menu-btn">Cantiere</button>
        <mat-menu #cantiereMenu="matMenu">
          <button mat-menu-item *ngFor="let vehicle of mezziFilterService.filteredVehicles" (click)="selectService.preventSelectClosing($event)">
            <mat-checkbox>{{ vehicle.worksite?.['name'] || 'Non assegnato' }}</mat-checkbox>
          </button>
        </mat-menu>
      </th>
      <td mat-cell *matCellDef="let vehicle">
        {{ vehicle.worksite?.name  ? vehicle.worksite?.name  : "non assegnato" }}
      </td>
    </ng-container>


    <!-- Colonna Anno immatricolazione -->
    <ng-container matColumnDef="Anno immatricolazione">
      <th mat-header-cell *matHeaderCellDef>
        <button mat-button [matMenuTriggerFor]="annoMenu" class="filter-menu-btn">Anno immatricolazione</button>
        <mat-menu #annoMenu="matMenu">
          <button mat-menu-item>Item 1</button>
          <button mat-menu-item>Item 2</button>
        </mat-menu>
      </th>
      <td mat-cell *matCellDef="let vehicle"> {{ "anno" }} </td>
    </ng-container>

    <!-- Colonna Tipologia attrezzatura -->
    <ng-container matColumnDef="Tipologia attrezzatura">
      <th mat-header-cell *matHeaderCellDef>
        <button mat-button [matMenuTriggerFor]="attrezzaturaMenu" class="filter-menu-btn">Tipologia attrezzatura</button>
        <mat-menu #attrezzaturaMenu="matMenu">
          <button mat-menu-item>Item 1</button>
          <button mat-menu-item>Item 2</button>
        </mat-menu>
      </th>
      <td mat-cell *matCellDef="let vehicle"> {{ "tipo" }} </td>
    </ng-container>

    <!-- Colonna Allestimento -->
    <ng-container matColumnDef="Allestimento">
      <th mat-header-cell *matHeaderCellDef>
        <button mat-button [matMenuTriggerFor]="allestimentoMenu" class="filter-menu-btn">Allestimento</button>
        <mat-menu #allestimentoMenu="matMenu">
          <button mat-menu-item (click)="selectService.preventSelectClosing($event)">
            <mat-checkbox>
              Blackbox
            </mat-checkbox>
          </button>
          <button mat-menu-item (click)="selectService.preventSelectClosing($event)">
            <mat-checkbox>
              Blackbox + antenna
            </mat-checkbox>
          </button>
        </mat-menu>
      </th>
      <td mat-cell *matCellDef="let vehicle"> {{ vehicle.isRFIDReader ? "Blackbox+antenna": "Blackbox" }} </td>
    </ng-container>

    <!-- Colonna Data installazione fleet -->
    <ng-container matColumnDef="Data-installazione-fleet">
      <th mat-header-cell *matHeaderCellDef>
        <button mat-button [matMenuTriggerFor]="installazioneMenu" class="filter-menu-btn">Data installazione fleet</button>
        <mat-menu #installazioneMenu="matMenu">
          <button mat-menu-item *ngFor="let vehicle of mezziFilterService.filteredVehicles" (click)="selectService.preventSelectClosing($event)">
            <mat-checkbox>{{vehicle.firstEvent | date:'dd/MM/yyyy'}}</mat-checkbox>
          </button>
        </mat-menu>
      </th>
      <td mat-cell *matCellDef="let vehicle">{{ vehicle.firstEvent | date:'dd/MM/yyyy' }}</td>
    </ng-container>


    <!-- Colonna Data rimozione apparato -->
    <ng-container matColumnDef="Data-rimozione-apparato">
      <th mat-header-cell *matHeaderCellDef>
        <button mat-button [matMenuTriggerFor]="rimozioneMenu" class="filter-menu-btn">Data rimozione apparato</button>
        <mat-menu #rimozioneMenu="matMenu">
          <button mat-menu-item>Item 1</button>
          <button mat-menu-item>Item 2</button>
        </mat-menu>
      </th>
      <td mat-cell *matCellDef="let vehicle"> {{ vehicle.retiredEvent ? "SI" : "NO"}} </td>
    </ng-container>

    <!-- Colonna Notes -->
    <ng-container matColumnDef="Notes">
      <th mat-header-cell *matHeaderCellDef > Notes </th>
      <td mat-cell *matCellDef="let vehicle"><textarea name="notes" class="notes" matInput></textarea></td>
    </ng-container>

    <!-- Definizione righe della tabella -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>
