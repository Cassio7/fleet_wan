<p *ngIf="!loading" class="loading-p">Caricamento dei dati dei veicoli...</p>
<div class="table-container">
  <table *ngIf="vehicleTableData" #vehicleTable mat-table [dataSource]="vehicleTableData" matSort (matSortChange)="onSortChange($event)">
    <!-- Targa Column -->
    <ng-container matColumnDef="targa">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Targa </th>
      <td mat-cell *matCellDef="let vehicle">
        <mat-icon style="cursor: pointer;" matTooltip="Qualche informazione sul veicolo (click per maggiori dettagli)">local_shipping</mat-icon>
        {{ vehicle.plate }}
      </td>
    </ng-container>

    <!-- Comune Column -->
    <ng-container matColumnDef="cantiere">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Cantiere </th>
      <td mat-cell *matCellDef="let vehicle"> {{ checkWorksite(vehicle) }} </td>
    </ng-container>

    <!-- GPS Column -->
    <ng-container matColumnDef="GPS">
      <th mat-header-cell *matHeaderCellDef> GPS </th>
      <td mat-cell *matCellDef="let vehicle">
        <mat-icon class="warning-icon" [matTooltip]="checkGpsError(vehicle)" *ngIf="checkGpsError(vehicle)" [matTooltipClass]="'gps-tooltip'">location_on</mat-icon>
        <mat-icon class="check-icon" *ngIf="!checkGpsError(vehicle)" matTooltip="Possiede un GPS funzionante">location_on</mat-icon>
      </td>
    </ng-container>

    <!-- Antenna Column -->
    <ng-container matColumnDef="antenna">
      <th mat-header-cell *matHeaderCellDef> Antenna </th>
      <td mat-cell *matCellDef="let vehicle">
        <div class="icon-container">
          <mat-icon *ngIf="vehicle.isRFIDReader && !checkAntennaError(vehicle)" class="check-icon" matTooltip="Possiede un'antenna RFID funzionante">wifi_off</mat-icon>
          <mat-icon *ngIf="vehicle.isRFIDReader && checkAntennaError(vehicle)" class="error-icon" [matTooltip]="checkAntennaError(vehicle) ? checkAntennaError(vehicle) : 'Anomalia antenna RFID'">wifi_off</mat-icon>
          <div class="noAntenna-icon">
            <mat-icon *ngIf="!vehicle.isRFIDReader && !checkAntennaError(vehicle)" class="antenna-icon" matTooltip="Non ha un'antenna RFID">wifi_off</mat-icon>
          </div>
        </div>
      </td>
    </ng-container>

    <!-- Sessione Column -->
    <ng-container matColumnDef="sessione">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Sessione </th>
      <td mat-cell *matCellDef="let vehicle">
        <mat-icon class="error-icon" *ngIf="checkSessionError(vehicle)" [matTooltip]="checkSessionError(vehicle)">
          error
        </mat-icon>
        <mat-icon class="check-icon" *ngIf="!checkSessionError(vehicle) && vehicle.lastValidSession?.period_to" matTooltip="Sessione corretta">
          check_circle
        </mat-icon>
        {{ vehicle.lastValidSession?.period_to ? (vehicle.lastValidSession.period_from | date: 'dd/MM/yy hh:mm') : '' }}
      </td>
    </ng-container>

    <!-- Header and Row Definitions -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns, sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>
