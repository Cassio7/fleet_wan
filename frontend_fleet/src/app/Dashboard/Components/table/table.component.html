<div class="table-over">
  <app-row-filter></app-row-filter>
  <p>Numero di veicoli: {{vehicleTableData.data.length || '-'}}</p>
  <button mat-raised-button (click)="fillTable()">Ricarica dati</button>
</div>
<div class="table-container">
  <table *ngIf="vehicleTableData" #vehicleTable mat-table [dataSource]="vehicleTableData" matSort (matSortChange)="onSortChange($event)" class="mat-elevation-z8 table-el">
    <!-- Comune Column -->
    <ng-container matColumnDef="cantiere">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Cantiere </th>
      <td mat-cell *matCellDef="let vehicle"> {{ checkWorksite(vehicle) }} </td>
    </ng-container>

    <!-- Targa Column -->
    <ng-container matColumnDef="targa">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Targa </th>
      <td mat-cell *matCellDef="let vehicle">
        <mat-icon>local_shipping</mat-icon>
        {{ vehicle.plate }}
      </td>
    </ng-container>

    <!-- GPS Column -->
    <ng-container matColumnDef="GPS">
      <th mat-header-cell *matHeaderCellDef> GPS </th>
      <td mat-cell *matCellDef="let vehicle">
        <mat-icon class="warning-icon" [matTooltip]="checkGpsError(vehicle)" *ngIf="checkGpsError(vehicle)" [matTooltipClass]="'gps-tooltip'">share_location</mat-icon>
        <mat-icon class="check-icon" *ngIf="!checkGpsError(vehicle)" matTooltip="Possiede un GPS funzionante">share_location</mat-icon>
      </td>
    </ng-container>

    <!-- Antenna Column -->
    <ng-container matColumnDef="antenna">
      <th mat-header-cell *matHeaderCellDef> Antenna </th>
      <td mat-cell *matCellDef="let vehicle">
        <div class="icon-container">
          <mat-icon *ngIf="vehicle.isRFIDReader && !checkAntennaError(vehicle)" class="check-icon" matTooltip="Possiede un'antenna RFID funzionante">settings_input_antenna</mat-icon>
          <mat-icon *ngIf="vehicle.isRFIDReader && checkAntennaError(vehicle)" class="error-icon" matTooltip="Anomalia antenna RFID">settings_input_antenna</mat-icon>
          <mat-icon *ngIf="!vehicle.isRFIDReader && !checkAntennaError(vehicle)" class="antenna-icon" matTooltip="Non ha un'antenna RFID">settings_input_antenna</mat-icon>
          <mat-icon *ngIf="!vehicle.isRFIDReader && !checkAntennaError(vehicle)" class="close-icon" matTooltip="Non ha un'antenna RFID">close</mat-icon>
        </div>
      </td>
    </ng-container>

    <!-- Sessione Column -->
    <ng-container matColumnDef="sessione">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Sessione </th>
      <td mat-cell *matCellDef="let vehicle">
        <mat-icon class="check-icon" *ngIf="!checkSessionError(vehicle) && vehicle.lastValidSession.period_from" matTooltip="Sessione corretta">check_circle</mat-icon>
        <mat-icon class="error-icon" matTooltip="Nessuna sessione trovata" *ngIf="checkSessionError(vehicle)">error</mat-icon>
        {{ vehicle.lastValidSession?.period_from ? (vehicle.lastValidSession.period_from | date: 'dd/MM/yy hh:mm') : 'Nessuna sessione' }}
      </td>
    </ng-container>

    <!-- Header and Row Definitions -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>
